# How to train DPR and ANCE

To train `DPR` and `ANCE` on a new dataset:
```bash
# tokenize corpus and cache them, collect ground-truths
python -m scripts.preprocess base=XXX

# test BM25 performance on the dataset
python run.py -cn bm25 base=XXX

# collect BM25 top ranked result
python run.py -cn bm25 base=XXX +eval_set=train

# collect hard negatives from BM25 top ranking results
python run.py -cn scripts.negative base=XXX hard_neg_type=BM25

# train DPR (text_length and query_length are 512 and 64 by default)
python run.py -cn dpr base=XXX

# collect DPR top ranked result, specifying hits=200 so that we only store the top 200 documents per query
python run.py -cn dpr base=XXX +eval_set=train +hits=200 ++mode=eval

# collect hard negatives from DPR top ranking results
python run.py -cn scripts.negative base=XXX hard_neg_type=DPR

# continue to train DPR with hard negatives from itself
python run.py -cn dpr base=XXX +hard_neg_type=DPR +checkpoint=DPR/best ++verbose=hn
```